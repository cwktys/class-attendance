<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­ç´šåˆ°é”æ“å ´ç®¡ç†ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // ğŸ”¥ è«‹å°‡ä¸‹é¢çš„è¨­å®šæ”¹ç‚ºæ‚¨å¾Firebaseè¤‡è£½çš„è¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyAqLitpQ-W2EFVJb5ytlh_fFaXEfGdsOns",
            authDomain: "classroom-tracker-demo.firebaseapp.com",
            databaseURL: "https://classroom-tracker-demo-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "classroom-tracker-demo",
            storageBucket: "classroom-tracker-demo.firebasestorage.app",
            messagingSenderId: "889652567824",
            appId: "1:889652567824:web:e9017d7dc072b0c8624f95"
",
            appId: "è«‹è²¼ä¸Šæ‚¨çš„APP ID"
        };

        // åˆå§‹åŒ– Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // è®“å…¶ä»–è…³æœ¬å¯ä»¥ä½¿ç”¨ database
        window.database = database;
        window.dbRef = ref;
        window.dbSet = set;
        window.dbGet = get;
        window.dbOnValue = onValue;
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .arrived {
            animation: pulse 2s ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .status-badge {
            transition: all 0.3s ease;
        }

        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            z-index: 1000;
        }

        .connected {
            background-color: #10B981;
            color: white;
        }

        .disconnected {
            background-color: #EF4444;
            color: white;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    },
                    fontFamily: {
                        sans: ['Noto Sans TC', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-white dark:bg-gray-900 min-h-screen transition-colors duration-300">
    <!-- é€£ç·šç‹€æ…‹æŒ‡ç¤º -->
    <div id="connectionStatus" class="connection-status disconnected">
        ğŸ”´ é›¢ç·š
    </div>

    <div class="w-full h-full">
        <!-- æ‰‹æ©Ÿç‰ˆå¸ƒå±€ -->
        <div class="md:hidden">
            <!-- æ‰‹æ©Ÿç‰ˆï¼šé ‚éƒ¨æ©«å‘å¸ƒå±€ -->
            <div class="flex gap-3 mb-3">
                <!-- æ ¡å¾½ -->
                <div class="flex-shrink-0">
                    <img src="https://pfst.cf2.poecdn.net/base/image/d1bac803e09e2aa47fef77acb1020b7332c5512b872f9ac730ecee837ec17c8e?w=200&h=237" 
                         alt="æ ¡å¾½" 
                         class="w-20 h-24 object-contain">
                </div>
                
                <!-- çµ±è¨ˆè³‡è¨Š -->
                <div class="flex gap-2 flex-1">
                    <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-2 text-center flex-1">
                        <div class="text-lg font-bold text-blue-600 dark:text-blue-400" id="totalClassesMobile">0</div>
                        <div class="text-blue-800 dark:text-blue-300 text-xs">ç¸½æ•¸</div>
                    </div>
                    <div class="bg-green-50 dark:bg-green-900/30 rounded-lg p-2 text-center flex-1">
                        <div class="text-lg font-bold text-green-600 dark:text-green-400" id="arrivedClassesMobile">0</div>
                        <div class="text-green-800 dark:text-green-300 text-xs">å·²åˆ°é”</div>
                    </div>
                    <div class="bg-orange-50 dark:bg-orange-900/30 rounded-lg p-2 text-center flex-1">
                        <div class="text-lg font-bold text-orange-600 dark:text-orange-400" id="pendingClassesMobile">0</div>
                        <div class="text-orange-800 dark:text-orange-300 text-xs">æœªåˆ°é”</div>
                    </div>
                </div>
            </div>
            
            <!-- æ‰‹æ©Ÿç‰ˆï¼šå°šæœªåˆ°é”ç­ç´šè­¦ç¤ºå€ -->
            <div id="pendingAlertMobile">
                <!-- å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
            </div>
            
            <!-- æ¨™é¡Œå€åŸŸ -->
            <div class="text-center mb-3">
                <h1 class="text-xl font-bold text-gray-800 dark:text-white mb-1">
                    ç­ç´šåˆ°é”æ“å ´ç®¡ç†
                </h1>
                <p class="text-gray-600 dark:text-gray-300 text-sm">
                    é»æ“Šç­ç´šæŒ‰éˆ•ä¾†æ¨™è¨˜åˆ°é”ç‹€æ…‹ - å³æ™‚åŒæ­¥
                </p>
            </div>

            <!-- æ§åˆ¶æŒ‰éˆ• -->
            <div class="flex gap-2 justify-center mb-3">
                <button onclick="resetAll()" 
                        class="px-3 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors duration-200 text-sm">
                    é‡ç½®å…¨éƒ¨
                </button>
                <button onclick="markAllArrived()" 
                        class="px-3 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors duration-200 text-sm">
                    å…¨éƒ¨åˆ°é”
                </button>
            </div>

            <!-- ç­ç´šåˆ—è¡¨ -->
            <div class="grid grid-cols-4 gap-2" id="classGridMobile">
                <!-- ç­ç´šå¡ç‰‡å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>

        <!-- æ¡Œé¢ç‰ˆï¼šå°ˆç‚º1920x1080å„ªåŒ–çš„å…¨å±é¡¯ç¤ºç‰ˆ -->
        <div class="hidden md:flex flex-col w-screen h-screen overflow-hidden p-8 gap-8">
            <!-- é ‚éƒ¨ï¼šæ ¡å¾½å±…ä¸­ - 1920x1200å„ªåŒ– -->
            <div class="flex justify-center items-center" style="height: 240px;">
                <img src="https://pfst.cf2.poecdn.net/base/image/d1bac803e09e2aa47fef77acb1020b7332c5512b872f9ac730ecee837ec17c8e?w=200&h=237" 
                     alt="æ ¡å¾½" 
                     class="w-48 h-56 object-contain">
            </div>

            <!-- å·²åˆ°é”ç­ç´šé¡¯ç¤ºå€åŸŸ - å……åˆ†åˆ©ç”¨1920x1080å‰©é¤˜ç©ºé–“ -->
            <div class="flex-1 w-full" id="pendingAlert">
                <!-- å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        // æ·±è‰²æ¨¡å¼æª¢æ¸¬
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // ç­ç´šè³‡æ–™
        const classes = [
            { id: 'class1A', name: '1A', grade: 1 },
            { id: 'class1B', name: '1B', grade: 1 },
            { id: 'class1C', name: '1C', grade: 1 },
            { id: 'class1D', name: '1D', grade: 1 },
            { id: 'class2A', name: '2A', grade: 2 },
            { id: 'class2B', name: '2B', grade: 2 },
            { id: 'class2C', name: '2C', grade: 2 },
            { id: 'class2D', name: '2D', grade: 2 },
            { id: 'class3A', name: '3A', grade: 3 },
            { id: 'class3B', name: '3B', grade: 3 },
            { id: 'class3C', name: '3C', grade: 3 },
            { id: 'class3D', name: '3D', grade: 3 }
        ];

        // ç­ç´šç‹€æ…‹
        let classStatus = {};
        let isFirebaseReady = false;

        // ç­‰å¾… Firebase åˆå§‹åŒ–
        function waitForFirebase() {
            if (window.database) {
                isFirebaseReady = true;
                setupFirebaseListeners();
                updateConnectionStatus(true);
                loadDataFromFirebase();
            } else {
                setTimeout(waitForFirebase, 100);
            }
        }

        // è¨­ç½® Firebase ç›£è½å™¨
        function setupFirebaseListeners() {
            const statusRef = window.dbRef(window.database, 'classStatus');
            let isFirstLoad = true;
            
            window.dbOnValue(statusRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    const newStatus = data;
                    
                    // æª¢æ¸¬ç‹€æ…‹è®ŠåŒ–ä¸¦æ’­æ”¾èªéŸ³ï¼ˆåªé‡å°ç¶²é ç‰ˆï¼‰
                    if (!isFirstLoad && window.innerWidth >= 768) {
                        // æ¯”è¼ƒæ–°èˆŠç‹€æ…‹ï¼Œæ‰¾å‡ºè®ŠåŒ–çš„ç­ç´š
                        Object.keys(newStatus).forEach(classId => {
                            const oldValue = classStatus[classId];
                            const newValue = newStatus[classId];
                            
                            // å¦‚æœç‹€æ…‹æœ‰è®ŠåŒ–ï¼Œæ’­æ”¾èªéŸ³
                            if (oldValue !== newValue) {
                                const className = classes.find(cls => cls.id === classId)?.name;
                                if (className) {
                                    // å»¶é²ä¸€é»æ’­æ”¾èªéŸ³ï¼Œç¢ºä¿UIæ›´æ–°å®Œæˆ
                                    setTimeout(() => {
                                        playArrivalAnnouncement(className, newValue);
                                    }, 300);
                                }
                            }
                        });
                    }
                    
                    classStatus = newStatus;
                    renderClasses();
                    isFirstLoad = false;
                }
            });
        }

        // å¾ Firebase è¼‰å…¥è³‡æ–™
        async function loadDataFromFirebase() {
            try {
                const statusRef = window.dbRef(window.database, 'classStatus');
                const snapshot = await window.dbGet(statusRef);
                if (snapshot.exists()) {
                    classStatus = snapshot.val();
                } else {
                    // å¦‚æœæ²’æœ‰è³‡æ–™ï¼Œåˆå§‹åŒ–é è¨­ç‹€æ…‹
                    initializeClasses();
                    await saveToFirebase();
                }
                renderClasses();
            } catch (error) {
                console.error('è¼‰å…¥è³‡æ–™å¤±æ•—:', error);
                updateConnectionStatus(false);
                initializeClasses();
                renderClasses();
            }
        }

        // å„²å­˜åˆ° Firebase
        async function saveToFirebase() {
            if (!isFirebaseReady) return;
            try {
                const statusRef = window.dbRef(window.database, 'classStatus');
                await window.dbSet(statusRef, classStatus);
            } catch (error) {
                console.error('å„²å­˜å¤±æ•—:', error);
                updateConnectionStatus(false);
            }
        }

        // æ›´æ–°é€£ç·šç‹€æ…‹é¡¯ç¤º
        function updateConnectionStatus(connected) {
            const statusEl = document.getElementById('connectionStatus');
            if (connected) {
                statusEl.className = 'connection-status connected';
                statusEl.innerHTML = 'ğŸŸ¢ å·²é€£ç·š';
            } else {
                statusEl.className = 'connection-status disconnected';
                statusEl.innerHTML = 'ğŸ”´ é›¢ç·š';
            }
        }

        // åˆå§‹åŒ–ç­ç´šç‹€æ…‹
        function initializeClasses() {
            classes.forEach(cls => {
                classStatus[cls.id] = false;
            });
        }

        // å‰µå»ºç­ç´šå¡ç‰‡
        function createClassCard(cls) {
            const isArrived = classStatus[cls.id];
            
            return `
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 overflow-hidden border ${isArrived ? 'border-green-500' : 'border-gray-200 dark:border-gray-700'}">
                    <div class="p-3">
                        <div class="text-center mb-3">
                            <div class="flex items-center justify-center mb-2">
                                <h3 class="text-xl font-bold text-gray-800 dark:text-white mr-2">
                                    ${cls.name}
                                </h3>
                                <span class="status-badge inline-flex items-center px-3 py-1 rounded-full text-base font-bold ${isArrived ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400' : 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400'}">
                                    ${isArrived ? 'âœ… å·²åˆ°é”' : 'â³ æœªåˆ°é”'}
                                </span>
                            </div>
                            <span class="px-2 py-1 text-xs font-medium rounded-full ${getGradeColor(cls.grade)}">
                                ${cls.grade}å¹´ç´š
                            </span>
                        </div>
                        
                        <button onclick="toggleClassStatus('${cls.id}')" 
                                class="w-full px-3 py-2 rounded-lg font-medium transition-all duration-200 text-sm ${isArrived ? 'bg-orange-500 hover:bg-orange-600 text-white' : 'bg-primary hover:bg-primary/90 text-white'}">
                            ${isArrived ? 'æ¨™è¨˜æœªåˆ°é”' : 'æ¨™è¨˜å·²åˆ°é”'}
                        </button>
                    </div>
                </div>
            `;
        }

        // ç²å–å¹´ç´šé¡è‰²
        function getGradeColor(grade) {
            const colors = {
                1: 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400',
                2: 'bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400',
                3: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400'
            };
            return colors[grade] || 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300';
        }

        // æ¸²æŸ“ç­ç´šåˆ—è¡¨
        function renderClasses() {
            // æ‰‹æ©Ÿç‰ˆç­ç´šåˆ—è¡¨
            const classGridMobile = document.getElementById('classGridMobile');
            if (classGridMobile) {
                const classCards = classes.map(cls => createClassCard(cls)).join('');
                classGridMobile.innerHTML = classCards;
            }
            
            updateStatistics();
        }

        // èªéŸ³æ’­å ±åŠŸèƒ½ï¼ˆæ ¹æ“šè¨­å‚™é¸æ“‡èªè¨€ï¼Œå„ªå…ˆå¥³è²ï¼‰
        function playArrivalAnnouncement(className, isArrived) {
            // æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´èªéŸ³åˆæˆ
            if ('speechSynthesis' in window) {
                try {
                    // æª¢æ¸¬æ˜¯å¦ç‚ºæ¡Œé¢ç‰ˆï¼ˆç¶²é ç‰ˆï¼‰
                    const isDesktop = window.innerWidth >= 768; // md æ–·é»
                    
                    let message, language, rate;
                    
                    if (isDesktop) {
                        // ç¶²é ç‰ˆï¼šä½¿ç”¨å»£æ±è©±
                        message = isArrived ? `${className}ç­å·²ç¶“åˆ°å’—` : `${className}ç­å·²ç¶“èµ°å’—`;
                        language = 'zh-HK';
                        rate = 0.7; // æ”¾æ…¢èªé€Ÿï¼Œé¿å…è¢«æˆªæ–·
                    } else {
                        // æ‰‹æ©Ÿç‰ˆï¼šä½¿ç”¨ä¸­æ–‡
                        message = isArrived ? `${className}ç­å·²åˆ°é”` : `${className}ç­å·²é›¢é–‹`;
                        language = 'zh-TW';
                        rate = 0.8; // ç¨å¾®æ”¾æ…¢èªé€Ÿ
                    }
                    
                    // ç­‰å¾…èªéŸ³å¼•æ“æº–å‚™å¥½
                    const waitForVoices = () => {
                        return new Promise((resolve) => {
                            const voices = window.speechSynthesis.getVoices();
                            if (voices.length > 0) {
                                resolve(voices);
                            } else {
                                // ç­‰å¾…èªéŸ³è¼‰å…¥å®Œæˆ
                                window.speechSynthesis.onvoiceschanged = () => {
                                    resolve(window.speechSynthesis.getVoices());
                                };
                            }
                        });
                    };
                    
                    waitForVoices().then((voices) => {
                        // åªæœ‰ç•¶å‰é¢æ²’æœ‰èªéŸ³åœ¨æ’­æ”¾æ™‚æ‰åœæ­¢
                        if (window.speechSynthesis.speaking) {
                            window.speechSynthesis.cancel();
                            // ç­‰å¾…ä¸€ä¸‹ç¢ºä¿å®Œå…¨åœæ­¢
                            setTimeout(() => {
                                playVoice();
                            }, 100);
                        } else {
                            playVoice();
                        }
                        
                        function playVoice() {
                            const utterance = new SpeechSynthesisUtterance(message);
                            utterance.lang = language;
                            utterance.rate = rate;
                            utterance.pitch = 1.1; // ç¨å¾®æé«˜éŸ³èª¿
                            utterance.volume = 1.0;
                            
                            let selectedVoice = null;
                            
                            if (isDesktop) {
                                // ç¶²é ç‰ˆï¼šå„ªå…ˆé¸æ“‡å»£æ±è©±å¥³è²
                                selectedVoice = voices.find(voice => 
                                    (voice.lang.includes('zh-HK') || voice.lang.includes('yue')) &&
                                    (voice.name.toLowerCase().includes('female') || 
                                     voice.name.toLowerCase().includes('woman') ||
                                     voice.name.toLowerCase().includes('ä½³') ||
                                     voice.name.toLowerCase().includes('æ¬£') ||
                                     voice.name.toLowerCase().includes('ç¾') ||
                                     voice.name.toLowerCase().includes('éº—'))
                                );
                                
                                // å¦‚æœæ²’æ‰¾åˆ°å¥³è²ï¼Œå°±æ‰¾ä»»ä½•å»£æ±è©±èªéŸ³
                                if (!selectedVoice) {
                                    selectedVoice = voices.find(voice => 
                                        voice.lang.includes('zh-HK') || 
                                        voice.lang.includes('yue') ||
                                        voice.name.toLowerCase().includes('cantonese') ||
                                        voice.name.toLowerCase().includes('hongkong')
                                    );
                                }
                            } else {
                                // æ‰‹æ©Ÿç‰ˆï¼šå„ªå…ˆé¸æ“‡ä¸­æ–‡å¥³è²
                                selectedVoice = voices.find(voice => 
                                    voice.lang.includes('zh') &&
                                    (voice.name.toLowerCase().includes('female') || 
                                     voice.name.toLowerCase().includes('woman') ||
                                     voice.name.toLowerCase().includes('ä½³') ||
                                     voice.name.toLowerCase().includes('æ¬£') ||
                                     voice.name.toLowerCase().includes('ç¾') ||
                                     voice.name.toLowerCase().includes('éº—'))
                                );
                            }
                            
                            if (selectedVoice) {
                                utterance.voice = selectedVoice;
                                console.log(`ä½¿ç”¨${isDesktop ? 'å»£æ±è©±' : 'ä¸­æ–‡'}å¥³è²: ${selectedVoice.name}`);
                            } else {
                                console.log(`æœªæ‰¾åˆ°${isDesktop ? 'å»£æ±è©±' : 'ä¸­æ–‡'}å¥³è²ï¼Œä½¿ç”¨é è¨­èªéŸ³`);
                            }
                            
                            // è¨­å®šèªéŸ³äº‹ä»¶ç›£è½
                            utterance.onstart = () => {
                                console.log(`é–‹å§‹æ’­æ”¾èªéŸ³: ${message}`);
                            };
                            
                            utterance.onend = () => {
                                console.log(`èªéŸ³æ’­æ”¾å®Œæˆ: ${message}`);
                            };
                            
                            utterance.onerror = (error) => {
                                console.log('èªéŸ³æ’­æ”¾éŒ¯èª¤:', error);
                            };
                            
                            // æ’­æ”¾èªéŸ³
                            window.speechSynthesis.speak(utterance);
                        }
                    });
                    
                } catch (error) {
                    console.log('èªéŸ³æ’­å ±å¤±æ•—:', error);
                }
            } else {
                console.log('ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³åˆæˆ');
            }
        }

        // åˆ‡æ›ç­ç´šç‹€æ…‹
        async function toggleClassStatus(classId) {
            const oldStatus = classStatus[classId];
            const newStatus = !oldStatus;
            
            classStatus[classId] = newStatus;
            
            // æ’­æ”¾èªéŸ³é€šçŸ¥
            const className = classes.find(cls => cls.id === classId)?.name;
            if (className) {
                playArrivalAnnouncement(className, newStatus);
            }
            
            // ç«‹å³æ›´æ–°UI
            renderClasses();
            
            // å„²å­˜åˆ° Firebase
            await saveToFirebase();
        }

        // é‡ç½®å…¨éƒ¨
        async function resetAll() {
            Object.keys(classStatus).forEach(classId => {
                classStatus[classId] = false;
            });
            renderClasses();
            await saveToFirebase();
        }

        // æ¨™è¨˜å…¨éƒ¨åˆ°é”
        async function markAllArrived() {
            Object.keys(classStatus).forEach(classId => {
                classStatus[classId] = true;
            });
            renderClasses();
            await saveToFirebase();
        }

        // æ›´æ–°çµ±è¨ˆè³‡è¨Š
        function updateStatistics() {
            const total = classes.length;
            const arrived = Object.values(classStatus).filter(status => status).length;
            const pending = total - arrived;

            // æ¡Œé¢ç‰ˆ - æª¢æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼ˆç°¡åŒ–ç‰ˆæ²’æœ‰çµ±è¨ˆå…ƒç´ ï¼‰
            const totalClassesEl = document.getElementById('totalClasses');
            const arrivedClassesEl = document.getElementById('arrivedClasses');
            const pendingClassesEl = document.getElementById('pendingClasses');
            
            if (totalClassesEl) totalClassesEl.textContent = total;
            if (arrivedClassesEl) arrivedClassesEl.textContent = arrived;
            if (pendingClassesEl) pendingClassesEl.textContent = pending;
            
            // æ‰‹æ©Ÿç‰ˆ
            document.getElementById('totalClassesMobile').textContent = total;
            document.getElementById('arrivedClassesMobile').textContent = arrived;
            document.getElementById('pendingClassesMobile').textContent = pending;
            
            updatePendingAlert();
            updatePendingAlertMobile();
        }

        // æ›´æ–°å·²åˆ°é”ç­ç´šé¡¯ç¤ºå€
        function updatePendingAlert() {
            const pendingAlertDiv = document.getElementById('pendingAlert');
            const arrivedClasses = classes.filter(cls => classStatus[cls.id]);
            
            if (arrivedClasses.length === 0) {
                pendingAlertDiv.innerHTML = `
                    <div class="bg-gray-50 dark:bg-gray-800/30 border border-gray-200 dark:border-gray-700 rounded-lg p-4 text-center">
                        <div class="flex items-center justify-center mb-2">
                            <span class="text-2xl mr-2">â³</span>
                            <span class="text-lg font-semibold text-gray-600 dark:text-gray-400">å°šç„¡ç­ç´šåˆ°é”</span>
                        </div>
                        <p class="text-gray-500 dark:text-gray-500 text-sm">ç­ç´šåˆ°é”å¾Œæœƒé¡¯ç¤ºåœ¨é€™è£¡</p>
                    </div>
                `;
            } else {
                // ç‚ºæ¯å€‹å¹´ç´šåˆ†é…å°æ¯”è‰²
                const getClassColor = (className) => {
                    const grade = className.charAt(0); // å–å¾—å¹´ç´šæ•¸å­—
                    const colors = {
                        '1': 'bg-red-300 text-red-900 border-red-400 dark:bg-red-700/60 dark:text-red-100 dark:border-red-500', // 1å¹´ç´šï¼šç´…è‰²ç³»ï¼ˆå°æ¯”ç¶ è‰²ï¼‰
                        '2': 'bg-blue-300 text-blue-900 border-blue-400 dark:bg-blue-700/60 dark:text-blue-100 dark:border-blue-500', // 2å¹´ç´šï¼šè—è‰²ç³»ï¼ˆå°æ¯”ç¶ è‰²ï¼‰
                        '3': 'bg-purple-300 text-purple-900 border-purple-400 dark:bg-purple-700/60 dark:text-purple-100 dark:border-purple-500' // 3å¹´ç´šï¼šç´«è‰²ç³»ï¼ˆå°æ¯”ç¶ è‰²ï¼‰
                    };
                    return colors[grade] || 'bg-gray-300 text-gray-900 border-gray-400 dark:bg-gray-700/60 dark:text-gray-100 dark:border-gray-500';
                };

                // å°ˆç‚º1920x1200å„ªåŒ–ï¼Œæ›´å¤§çš„ç­ç´šæ–¹å¡Šå’Œå­—é«”
                const arrivedList = arrivedClasses.map(cls => 
                    `<div class="flex items-center justify-center text-9xl font-black ${getClassColor(cls.name)} rounded-3xl border-8 shadow-2xl" style="width: 210px; height: 210px;">
                        ${cls.name}
                    </div>`
                ).join('');
                
                // è£œé½Šç©ºä½ä»¥ä¿æŒç¶²æ ¼å®Œæ•´
                const totalSlots = 12;
                const emptySlots = totalSlots - arrivedClasses.length;
                const emptyList = Array(emptySlots).fill('').map(() => 
                    `<div style="width: 210px; height: 210px;"></div>`
                ).join('');
                
                const gradeRows = `<div class="grid grid-cols-4 grid-rows-3 justify-items-center items-center h-full" style="gap: 50px;">${arrivedList}${emptyList}</div>`;
                
                pendingAlertDiv.innerHTML = `
                    <div class="bg-green-100 dark:bg-green-900/50 border-4 border-green-600 dark:border-green-500 rounded-xl p-6 shadow-2xl">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center">
                                <span class="text-8xl mr-6">âœ…</span>
                                <span class="text-6xl font-black text-green-900 dark:text-green-200">å·²åˆ°é”çš„ç­ç´š</span>
                            </div>
                            <span class="px-6 py-3 text-4xl font-black bg-green-700 text-white rounded-xl shadow-lg">
                                ${arrivedClasses.length} å€‹ç­ç´š
                            </span>
                        </div>
                        ${gradeRows}
                    </div>
                `;
            }
        }

        // æ›´æ–°æ‰‹æ©Ÿç‰ˆå·²åˆ°é”ç­ç´šé¡¯ç¤ºå€
        function updatePendingAlertMobile() {
            const pendingAlertDiv = document.getElementById('pendingAlertMobile');
            const arrivedClasses = classes.filter(cls => classStatus[cls.id]);
            
            if (arrivedClasses.length === 0) {
                pendingAlertDiv.innerHTML = `
                    <div class="bg-gray-50 dark:bg-gray-800/30 border border-gray-200 dark:border-gray-700 rounded-lg p-3 text-center">
                        <div class="flex items-center justify-center">
                            <span class="text-lg mr-2">â³</span>
                            <span class="text-sm font-semibold text-gray-600 dark:text-gray-400">å°šç„¡ç­ç´šåˆ°é”</span>
                        </div>
                    </div>
                `;
            } else {
                // ç‚ºæ¯å€‹å¹´ç´šåˆ†é…å°æ¯”è‰² (æ‰‹æ©Ÿç‰ˆ)
                const getClassColorMobile = (className) => {
                    const grade = className.charAt(0); // å–å¾—å¹´ç´šæ•¸å­—
                    const colors = {
                        '1': 'bg-red-200 text-red-800 dark:bg-red-800/40 dark:text-red-200', // 1å¹´ç´šï¼šç´…è‰²ç³»ï¼ˆå°æ¯”ç¶ è‰²ï¼‰
                        '2': 'bg-blue-200 text-blue-800 dark:bg-blue-800/40 dark:text-blue-200', // 2å¹´ç´šï¼šè—è‰²ç³»ï¼ˆå°æ¯”ç¶ è‰²ï¼‰
                        '3': 'bg-purple-200 text-purple-800 dark:bg-purple-800/40 dark:text-purple-200' // 3å¹´ç´šï¼šç´«è‰²ç³»ï¼ˆå°æ¯”ç¶ è‰²ï¼‰
                    };
                    return colors[grade] || 'bg-gray-200 text-gray-800 dark:bg-gray-800/40 dark:text-gray-200';
                };

                // æ‰‹æ©Ÿç‰ˆï¼šæ›´ç·Šæ¹Šçš„é¡¯ç¤º - æ¯å€‹ç­ç´šä¸åŒé¡è‰²
                const arrivedList = arrivedClasses.map(cls => 
                    `<span class="inline-flex items-center justify-center w-10 h-10 text-sm font-bold ${getClassColorMobile(cls.name)}">
                        ${cls.name}
                    </span>`
                ).join('');
                
                pendingAlertDiv.innerHTML = `
                    <div class="bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-700 rounded-lg p-3">
                        <div class="flex items-center mb-2">
                            <span class="text-lg mr-2">âœ…</span>
                            <span class="text-sm font-bold text-green-800 dark:text-green-300">å·²åˆ°é”çš„ç­ç´š</span>
                            <span class="ml-2 px-2 py-1 text-xs font-bold bg-green-600 text-white rounded">
                                ${arrivedClasses.length}
                            </span>
                        </div>
                        <div class="grid grid-cols-6 gap-1">
                            ${arrivedList}
                        </div>
                    </div>
                `;
            }
        }

        // åˆå§‹åŒ–æ‡‰ç”¨
        function initApp() {
            updateConnectionStatus(false);
            initializeClasses();
            renderClasses();
            waitForFirebase();
        }

        // å•Ÿå‹•æ‡‰ç”¨
        initApp();
    </script>
</body>
</html>
